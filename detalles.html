<!-- detalles.html CORREGIDO -->

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalles - Sensor Ambiente</title>

    <!-- Manifest para Android -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Iconos Android -->
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/icons/icon-192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="/icons/icon-512.png"
    />

    <!-- Soporte iOS -->
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512.png" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />

    <meta name="mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Mi Sensor Ambiental" />

    <!-- Colores para Safari iOS -->
    <meta name="theme-color" content="#2196f3" />

    <link rel="stylesheet" href="styles/detalles.css" />
  </head>
  <body>
    <main>
      <h1>üåø Sensor Ambiental: <span id="nombre">Cargando...</span></h1>
      <div class="container">
        <!-- ESTE ENLACE AHORA EST√Å FUERA DEL CONTENEDOR FLEX -->
        <a href="index.html" class="back-link"
          >&larr; Volver a las Recomendaciones</a
        >

        <!-- ======================================================= -->
        <!-- NUEVO CONTENEDOR EXCLUSIVO PARA LAS COLUMNAS -->
        <!-- ======================================================= -->
        <div class="columnas-wrapper">
          <div class="columna-izquierda">
            <!-- SECCI√ìN 1: DATOS DEL SENSOR INTERIOR -->
            <section>
              <h2>üè° Clima Interior (Sensor)</h2>
              <!-- ... contenido de la secci√≥n ... -->
              <p>
                <b>Temperatura:</b>
                <span class="dato-principal" id="temp">-</span>
                <span class="tendencia" id="temp_trend"></span>
              </p>
              <p style="color: #ff8c00">
                <b>Sensaci√≥n T√©rmica:</b>
                <span class="dato-principal" id="sensacion">-</span>
                <span class="tendencia" id="sensacion_trend"></span>
              </p>
              <p style="color: #ff8c00">
                <b>Humedad:</b> <span class="dato-principal" id="hum">-</span>
                <span class="tendencia" id="hum_trend"></span>
              </p>
              <p>
                <b>Presi√≥n:</b>
                <span class="dato-principal" id="pres_nivel_mar">-</span>
                <span class="tendencia" id="pres_nivel_mar_trend"></span>
              </p>
              <p>
                <b>Ultimo Reporte:</b>
                <span class="dato-principal" id="ultimo_reporte">-</span>
              </p>
            </section>

            <!-- SECCI√ìN 2: ESTADO DEL DISPOSITIVO -->
            <section>
              <h2>üì° Estado del Dispositivo</h2>
              <!-- ... contenido de la secci√≥n ... -->
              <p><b>Estado:</b> <span id="estado_sensor">Conectado</span></p>
              <p>
                <b>Se√±al WiFi (RSSI):</b> <span id="rssi">-</span>
                <span id="rssi_calidad"></span>
              </p>
              <p><b>Direcci√≥n IP:</b> <span id="ip">-</span></p>
              <p><b>Coordenadas:</b> <span id="coordenadas">-</span></p>
              <p><b>Presi√≥n Absoluta (sensor):</b> <span id="pres">-</span></p>
              <p><b>Firmware:</b> <span id="firmware">-</span></p>
            </section>
          </div>

          <!-- SECCI√ìN 3: CLIMA EXTERIOR OWM (COLUMNA DERECHA) -->
          <section class="columna-derecha">
            <h2>üå§Ô∏è Clima Exterior (Satelite)</h2>
            <!-- ... todo el contenido de la secci√≥n de clima exterior ... -->
            <p>
              <b>Temperatura:</b>
              <span class="dato-principal" id="temp_ext">-</span>
              <span class="tendencia" id="temp_ext_trend"></span>
            </p>
            <p style="color: #ff8c00">
              <b>Sensaci√≥n Termica:</b>
              <span class="dato-principal" id="sensacion_ext">-</span>
              <span class="tendencia" id="sensacion_ext_trend"></span>
            </p>
            <p style="color: #ff8c00">
              <b>Humedad:</b> <span class="dato-principal" id="hum_ext">-</span>
              <span class="tendencia" id="hum_ext_trend"></span>
            </p>
            <p>
              <b>Presi√≥n:</b>
              <span class="dato-principal" id="pres_ext">-</span>
              <span class="tendencia" id="pres_ext_trend"></span>
            </p>
            <p>
              <b>Probabilidad de Lluvia 1h:</b> <span id="lluvia_ext">-</span>
            </p>
            <p style="color: #ff8c00">
              <b>Pron√≥stico 1h:</b> <span id="pop_1h_porc">-</span>
              <span class="desc" id="pop_1h_desc"></span>
            </p>
            <p>
              <b>Punto de Roc√≠o:</b>
              <span class="dato-principal" id="rocio_ext">-</span>
              <span class="tendencia" id="rocio_ext_trend">-</span>
            </p>
            <p><span id="descripcion_ext">-</span></p>
            <p>
              <b>Calidad del Aire (AQI):</b>
              <span class="dato-principal" id="aqi_ext">-</span>
              <span id="aqi_calidad"></span>
            </p>
            <!-- <div class="pronostico-container"> -->
            <p><b>Pron√≥stico de Lluvia:</b></p>
            <ul class="rain-forecast">
              <li>
                <span class="time-label">Pr√≥x. 3 horas:</span>
                <span>
                  <span class="percentage" id="pop_3h_porc">-</span>
                  <span class="description" id="pop_3h_desc"></span>
                </span>
              </li>
              <li>
                <span class="time-label">Pr√≥x. 6 horas:</span>
                <span>
                  <span class="percentage" id="pop_6h_porc">-</span>
                  <span class="description" id="pop_6h_desc"></span>
                </span>
              </li>
              <li>
                <span class="time-label">Ma√±ana:</span>
                <span>
                  <span class="percentage" id="pop_manana_porc">-</span>
                  <span class="description" id="pop_manana_desc"></span>
                </span>
              </li>
            </ul>
            <!-- </div> -->
            <p>
              <b>Ubicaci√≥n - Descripcion:</b> <span id="ubicacion_ext">-</span
              ><span id="condicion_ext">-</span>
            </p>
            <!-- <p><span id="descripcion_ext">-Desc-Ext</span></p> -->
            <p>
              <b>Ultimo Reporte:</b>
              <span class="dato-principal" id="ultimo_reporte_ext">-</span>
            </p>
          </section>
        </div>
        <!-- Fin de .columnas-wrapper -->
      </div>
      <!-- Fin de .container -->
    </main>

    <!-- 1. script para manejar el mac en la entrda a la aplicacion -->
    <script type="module">
      // Importamos la funci√≥n de arranque de nuestra app de detalles
      import { appDetalles } from "./js/main-detalles.js";

      // Esta funci√≥n se ejecuta tan pronto como la p√°gina carga
      window.addEventListener("load", () => {
        const macGuardada = localStorage.getItem("sensor_mac");

        if (macGuardada) {
          // Si tenemos la MAC, iniciamos la app con ella
          appDetalles(macGuardada);
        } else {
          // Si no, redirigimos al inicio
          window.location.href = "/";
        }

        // 2. Registramos el Service Worker (nuevo c√≥digo integrado)
        registrarServiceWorker();
      });

      // --- C√ìDIGO NUEVO PARA EL SERVICE WORKER ---
      function registrarServiceWorker() {
        // Comprobamos si el navegador soporta Service Workers
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log(
                "ServiceWorker registrado con √©xito. Scope:",
                registration.scope
              );
            })
            .catch((error) => {
              console.log("Fallo en el registro del ServiceWorker:", error);
            });
        }
      }
    </script>
  </body>
</html>
